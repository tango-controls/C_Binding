#==============================================================================
# Makefile to generate the Tango Binding for LabVIEW - NL - SOLEIL
#==============================================================================

#==============================================================================
# BASE DIR
#==============================================================================
BASE_DIR = /home/nicolas/soleil-root-linux

#==============================================================================
# OMNIORB INSTALL DIR
#==============================================================================
OMNIORB_BASE = $(BASE_DIR)/omniorb

#==============================================================================
# TANGO INSTALL DIR
#==============================================================================
TANGO_BASE = $(BASE_DIR)/tango

#==============================================================================
# LABVIEW INSTALL DIR (CINTOOLS)
#==============================================================================
LV_CINTOOLS = /usr/local/lv82/cintools

#==============================================================================
# INCLUDE DIRS
#==============================================================================
INCLUDE_DIRS = -I. \
               -I$(OMNIORB_BASE)/include \
							 -I$(TANGO_BASE)/include \
               -I$(LV_CINTOOLS)

#==============================================================================
# LIB DIRS
#==============================================================================
LIB_DIRS = -L$(OMNIORB_BASE)/lib/static \
           -L$(TANGO_BASE)/lib/static \
           -L$(LV_CINTOOLS)

#==============================================================================
# COMPILER/LINKER OPTIONS for GNU/LINUX
#==============================================================================
# COMMON
#------------------------------------------------------------------------------
SO_NAME = tango_binding
SO_EXT = so
#------------------------------------------------------------------------------
CC = g++
#------------------------------------------------------------------------------
CFLAGS_BASE = -fPIC -pipe -O2 -W -D_REENTRANT
#CFLAGS_BASE += -Wall -pthread -D_MT -D_GNU_SOURCE -m32
CFLAGS_BASE += -g -D_DEBUG
CFLAGS_BASE += -DHAS_TANGO_5_OR_SUP
#------------------------------------------------------------------------------
CFLAGS_NOVIREG = $(CFLAGS_BASE)
#------------------------------------------------------------------------------
CFLAGS_VIREG = $(CFLAGS_BASE)
CFLAGS_VIREG += -DUSE_VI_REGISTRATION 
#------------------------------------------------------------------------------
LD = gcc
#------------------------------------------------------------------------------
LDFLAGS_BASE = -shared
#LDFLAGS_BASE = -pthread -m32
LDFLAGS_BASE += -O -Wl,-soname,$(SO_NAME).$(SO_EXT)
#------------------------------------------------------------------------------
LDFLAGS_NOVIREG = $(LDFLAGS_BASE)
LDFLAGS_NOVIREG += -Wl,--version-script,$(SO_NAME)_no_register_vi.map
#------------------------------------------------------------------------------
LDFLAGS_VIREG = $(LDFLAGS_BASE)
LDFLAGS_VIREG += -Wl,--version-script,$(SO_NAME)_register_vi.map
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# ACTUAL OPTIONS TO USE (REG or NO REG)
#------------------------------------------------------------------------------
CFLAGS = $(CFLAGS_NOVIREG)
LDFLAGS = $(LDFLAGS_NOVIREG)

#------------------------------------------------------------------------------
# OBJ FILES
#------------------------------------------------------------------------------
OBJS_SO = DataAdapter.so.o \
	DeviceRepository.so.o \
	GroupRepository.so.o \
	Endianness.so.o \
	ErrorStack.so.o \
	EventManager.so.o \
	ObjectManager.so.o \
	TangoBinding.so.o \
	ThreadSafeDeviceProxy.so.o

#------------------------------------------------------------------------------
# LIBS (STATIC)
#------------------------------------------------------------------------------
LIBS_STATIC = -llv \
              -static -lomniORB4 \
              -static -lomniDynamic4 \
              -static -lCOS4 \
              -static -lomnithread \
              -static -ltango \
              -static -llog4tango
#------------------------------------------------------------------------------
# LIBS (SHARED)
#------------------------------------------------------------------------------
LIBS_SHARED = -llv \
              -lomniORB4 \
              -lomniDynamic4 \
              -lCOS4 \
              -lomnithread \
              -ltango \
              -llog4tango

#------------------------------------------------------------------------------
# RULE: all
#------------------------------------------------------------------------------
all: $(SO_NAME).$(SO_EXT) install

#------------------------------------------------------------------------------
# RULE: $(SO_NAME).$(SO_EXT)
#------------------------------------------------------------------------------
$(SO_NAME).$(SO_EXT): $(OBJS_SO)
	$(LD) -o $(SO_NAME).$(SO_EXT) $(LDFLAGS) $(OBJS_SO) $(LIB_DIRS) $(LIBS_STATIC)

#------------------------------------------------------------------------------
# RULE: DataAdapter.so.o
#------------------------------------------------------------------------------
DataAdapter.so.o: DataAdapter.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) DataAdapter.cpp -c -o DataAdapter.so.o

#------------------------------------------------------------------------------
# RULE: DeviceRepository.so.o
#------------------------------------------------------------------------------
DeviceRepository.so.o: DeviceRepository.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) DeviceRepository.cpp -c -o DeviceRepository.so.o

#------------------------------------------------------------------------------
# RULE: MexUtils.so.o
#------------------------------------------------------------------------------
Endianness.so.o: Endianness.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) Endianness.cpp -c -o Endianness.so.o

#------------------------------------------------------------------------------
# RULE: ErrorStack.so.o
#------------------------------------------------------------------------------
ErrorStack.so.o: ErrorStack.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) ErrorStack.cpp -c -o ErrorStack.so.o

#------------------------------------------------------------------------------
# RULE: EventManager.so.o
#------------------------------------------------------------------------------
EventManager.so.o: EventManager.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) EventManager.cpp -c -o EventManager.so.o

#------------------------------------------------------------------------------
# RULE: ObjectManager.so.o
#------------------------------------------------------------------------------
ObjectManager.so.o: ObjectManager.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) ObjectManager.cpp -c -o ObjectManager.so.o

#------------------------------------------------------------------------------
# RULE: TangoBinding.so.o
#------------------------------------------------------------------------------
TangoBinding.so.o: TangoBinding.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) TangoBinding.cpp -c -o TangoBinding.so.o

#------------------------------------------------------------------------------
# RULE: ThreadSafeDeviceProxy.so.o
#------------------------------------------------------------------------------
ThreadSafeDeviceProxy.so.o: ThreadSafeDeviceProxy.cpp
	$(CC) $(CFLAGS) $(INCLUDE_DIRS) ThreadSafeDeviceProxy.cpp -c -o ThreadSafeDeviceProxy.so.o

#------------------------------------------------------------------------------
# RULE: clean
#------------------------------------------------------------------------------
clean:
	rm -f *.so.o $(SO_NAME).$(SO_EXT)
	
#------------------------------------------------------------------------------
# RULE: install
#------------------------------------------------------------------------------
install:
	cp -f ./$(SO_NAME).$(SO_EXT) ../tango
	rm -f ./$(SO_NAME).$(SO_EXT)

	








